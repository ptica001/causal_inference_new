## Конспект 

### Корреляция, коэффициент корреляции, ковариация

**Корреляция (в смысле Пирсона)** — числовая мера **линейной** статистической связи (линейной ассоциации) между переменными $X$ и $Y$. Она описывает, насколько совместная изменчивость $X$ и $Y$ согласуется с **линейной** зависимостью.

**Коэффициент корреляции (Пирсона)** — нормированная ковариация двух переменных. Принимает значения от $-1$ до $1$  
```math
r_{XY}=\frac{\mathrm{cov}(X,Y)}{\sigma_X\sigma_Y}  
=\frac{\sum_{i=1}^{n}(X_i-\bar X)(Y_i-\bar Y)}  
{\sqrt{\sum_{i=1}^{n}(X_i-\bar X)^2;\sum_{i=1}^{n}(Y_i-\bar Y)^2}}  
```
Если $\sigma_X=0$ или $\sigma_Y=0$, коэффициент корреляции **не определён**.

**Ковариация** — мера совместной изменчивости двух переменных.

- $\mathrm{cov}(X,Y)>0$: большие значения $X$ чаще сочетаются с большими значениями $Y$ (и наоборот).
    
- $\mathrm{cov}(X,Y)<0$: большие значения $X$ чаще сочетаются с меньшими значениями $Y$.
    
- Абсолютная величина ковариации **зависит от масштаба измерения** (единиц), поэтому сама по себе плохо подходит для сравнения “силы связи” между разными парами переменных.
    

**Важно:** статистическая ассоциация (в том числе корреляция) **не равна** причинно-следственной связи: “корреляция не означает причинность”. 

---

### Ассоциация, каузация, кофаўндер

**Ассоциация** — любая статистическая зависимость между переменными (может быть линейной или нелинейной). Ассоциация сама по себе **не задаёт направления** и **не гарантирует** причинность. 

**Каузация (причинно-следственная связь)** — утверждение о том, что **интервенция** (вмешательство) в $X$ приводит к изменению исхода $Y$ (например, меняет среднее/распределение $Y$). В причинных рассуждениях важно, что связь **направленная**: $X \rightarrow Y$. 

**Кофаўндер (спутывающий фактор)** — переменная (или набор переменных), которая влияет и на “лечение/воздействие” $T$, и на исход $Y$, из-за чего наблюдаемая ассоциация между $T$ и $Y$ может быть не причинной. В causal inference это формализуется через идеи **(не)обусловленной обменности/ignorability**: без нужных предпосылок сравнение “леченных” и “нелеченных” может не идентифицировать причинный эффект. 

Пример “аисты и рождаемость”: размер/благополучие деревни может выступать кофаўндером, создавая ассоциацию без причинной связи между аистами и рождаемостью. 

---

### Почему в ML часто путают ассоциацию и причинность (интуитивный пример)

В машинном обучении легко принять ассоциацию за причинную связь: модель может “объяснять” $Y$ через признак $X$, но это не значит, что **вмешательство** в $X$ изменит $Y$.

Пример (игрушечный): “питомец дружелюбен, когда виляет хвостом”. Ассоциация $\text{tail wag}\leftrightarrow \text{friendly}$ не означает, что если _заставить_ хвост вилять, то дружелюбие появится (возможна обратная причинность, скрытые причины и т.д.). Лечить нужно причинные механизмы, а не коррелирующие маркеры. 

---

## Потенциальные исходы и “лечение” (potential outcomes framework)

### Лечение / воздействие

**Лечение (treatment, intervention)** — воздействие/вмешательство, которое может быть применено к объекту.

- $T=1$: объект получил лечение,
    
- $T=0$: объект не получил лечение.
    

### Потенциальные результаты

Для каждого объекта $i$ определяют два потенциальных исхода:

- $Y_{0i}$: исход, который был бы у объекта (i), **если бы** он не получил лечение,
    
- $Y_{1i}$: исход, который был бы у объекта (i), **если бы** он получил лечение. 
    

**Наблюдаемый исход** связывается с потенциальными исходами так:  
```math
Y_i = T_i\cdot Y_{1i} + (1-T_i)\cdot Y_{0i}.  
```
То есть мы наблюдаем только один из двух потенциальных исходов — в зависимости от фактически полученного лечения. 
### Фундаментальная проблема причинного вывода

**Фундаментальная проблема каузального вывода:** невозможно одновременно наблюдать $Y_{1i}$ и $Y_{0i}$ для одного и того же объекта $i$. Поэтому индивидуальный причинный эффект напрямую не наблюдаем. 

### Индивидуальный эффект

**Индивидуальный эффект лечения** для объекта $i$:  
```math
\tau_i = Y_{1i} - Y_{0i}  
```
(как правило, ненаблюдаем напрямую). 

### Средние эффекты

**ATE (Average Treatment Effect)** — средний эффект лечения в популяции:  
```math
ATE = \mathbb{E}[Y_1 - Y_0].  
``` 

**ATT (Average Treatment effect on the Treated)** — средний эффект лечения среди получивших лечение:  
```math
ATT = \mathbb{E}[Y_1 - Y_0 \mid T=1].  
```

---

## Когда ассоциацию можно интерпретировать как причинный эффект (в терминах potential outcomes)

Чтобы из данных оценка “разницы между группами” имела причинную интерпретацию, обычно нужны предпосылки (в разных формулировках):

1. **Обменность / ignorability / (условная) независимость назначения лечения**  
    Интуитивно: после учёта релевантных ковариат $X$ группы $T=1$ и $T=0$ сравнимы по потенциальным исходам (нет неучтённого смешения). 
    
2. **Позитивность (positivity / experimental treatment assignment)**  
    Внутри страт по конфаундерам должны встречаться **оба** уровня лечения: иначе эффект неидентифицируем для таких страт. 
    
3. **Консистентность (consistency)**  
    Если объект фактически получил $T=a$, то наблюдаемый исход равен соответствующему потенциальному исходу: $Y(a)=Y$ при $T=a$. Консистентность “привязывает” потенциальные исходы к наблюдаемым данным. 
    
4. **Отсутствие интерференции (no interference)** — см. ниже (часть SUTVA). 
    

---

## Интерференция (определение)

**Интерференция (interference)** — ситуация, когда потенциальный исход одного объекта зависит не только от его собственного лечения, но и от назначений лечения другим объектам.

Формально (словами): _“потенциальные исходы любого индивида зависят от того, какое лечение получили другие индивиды”_. Отсутствие интерференции — это предположение, что **потенциальные исходы индивида не меняются при изменении назначений лечения другим**. 

Интерференция — ключевая причина, почему классические A/B-оценки могут ломаться в сетях, маркетплейсах, инфекционных заболеваниях, системах с конкуренцией и т.п. 
